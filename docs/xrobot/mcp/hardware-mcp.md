---
title: çµçŸ½AIå¹³å°ä¸è®¾å¤‡ç«¯MCPåè®®äº¤äº’æŒ‡å—
---   

## æ¦‚è¿°

MCPï¼ˆModel Context Protocolï¼‰æ˜¯æ–°ä¸€ä»£æ¨èç”¨äºç‰©è”ç½‘æ§åˆ¶çš„åè®®ï¼Œé€šè¿‡æ ‡å‡† JSON-RPC 2.0 æ ¼å¼åœ¨åå°ä¸è®¾å¤‡é—´å‘ç°å’Œè°ƒç”¨"å·¥å…·"ï¼ˆToolï¼‰ï¼Œå®ç°çµæ´»çš„è®¾å¤‡æ§åˆ¶ã€‚

æœ¬æ–‡è¯¦ç»†ä»‹ç»çµçŸ½AIå¹³å°ï¼ˆMCPå®¢æˆ·ç«¯ï¼‰ä¸è®¾å¤‡ç«¯ï¼ˆMCPæœåŠ¡å™¨ï¼‰ä¹‹é—´çš„åä½œæµç¨‹ï¼Œå¸®åŠ©å¼€å‘è€…å®ç°å¤§æ¨¡å‹é€šè¿‡MCPåè®®æ§åˆ¶ä¸‡ç‰©çš„èƒ½åŠ›ã€‚

## ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [ç›®å½•](#ç›®å½•)
- [å…¸å‹ä½¿ç”¨æµç¨‹](#å…¸å‹ä½¿ç”¨æµç¨‹)
  - [æµç¨‹å›¾](#æµç¨‹å›¾)
- [åè®®æ ¼å¼è§„èŒƒ](#åè®®æ ¼å¼è§„èŒƒ)
  - [æ•´ä½“æ¶ˆæ¯ç»“æ„](#æ•´ä½“æ¶ˆæ¯ç»“æ„)
  - [JSON-RPC 2.0å­—æ®µè¯´æ˜](#json-rpc-20å­—æ®µè¯´æ˜)
- [è¯¦ç»†äº¤äº’æµç¨‹](#è¯¦ç»†äº¤äº’æµç¨‹)
  - [æ­¥éª¤1ï¼šè¿æ¥å»ºç«‹ä¸èƒ½åŠ›é€šå‘Š](#æ­¥éª¤1è¿æ¥å»ºç«‹ä¸èƒ½åŠ›é€šå‘Š)
  - [æ­¥éª¤2ï¼šåˆå§‹åŒ–MCPä¼šè¯](#æ­¥éª¤2åˆå§‹åŒ–mcpä¼šè¯)
  - [æ­¥éª¤3ï¼šå‘ç°è®¾å¤‡å·¥å…·åˆ—è¡¨](#æ­¥éª¤3å‘ç°è®¾å¤‡å·¥å…·åˆ—è¡¨)
    - [å“åº”æ ¼å¼ä¸€ï¼šæ ‡å‡†å·¥å…·åˆ—è¡¨ï¼ˆå‘åå…¼å®¹ï¼‰](#å“åº”æ ¼å¼ä¸€æ ‡å‡†å·¥å…·åˆ—è¡¨å‘åå…¼å®¹)
    - [å“åº”æ ¼å¼äºŒï¼šå¸¦ç±»å‹æ ‡è¯†çš„å·¥å…·åˆ—è¡¨ï¼ˆæ¨èï¼‰](#å“åº”æ ¼å¼äºŒå¸¦ç±»å‹æ ‡è¯†çš„å·¥å…·åˆ—è¡¨æ¨è)
  - [æ­¥éª¤4ï¼šè°ƒç”¨è®¾å¤‡å·¥å…·](#æ­¥éª¤4è°ƒç”¨è®¾å¤‡å·¥å…·)
- [è®¾å¤‡ç«¯å·¥å…·æ³¨å†Œæ–¹æ³•](#è®¾å¤‡ç«¯å·¥å…·æ³¨å†Œæ–¹æ³•)
  - [AddToolæ–¹æ³•è¯´æ˜](#addtoolæ–¹æ³•è¯´æ˜)
  - [å…¸å‹æ³¨å†Œç¤ºä¾‹](#å…¸å‹æ³¨å†Œç¤ºä¾‹)
## å…¸å‹ä½¿ç”¨æµç¨‹

MCPåè®®çš„äº¤äº’ä¸»è¦å›´ç»•å®¢æˆ·ç«¯ï¼ˆçµçŸ½AIå¹³å°ï¼‰å‘ç°å’Œè°ƒç”¨è®¾å¤‡ä¸Šçš„"å·¥å…·"ï¼ˆToolï¼‰è¿›è¡Œï¼š

```
æ—¶é—´çº¿ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è®¾å¤‡ç«¯    â”‚                    â”‚   çµçŸ½AIå¹³å°    â”‚
â”‚ (MCPæœåŠ¡å™¨) â”‚                    â”‚  (MCPå®¢æˆ·ç«¯)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                    â”‚
       â”‚ â‘ â”€â”€ hello æ¶ˆæ¯ï¼ˆèƒ½åŠ›å£°æ˜ï¼‰â”€â”€â†’       â”‚
       â”‚                                    â”‚
       â”‚ â†â”€â”€ â‘¡ initializeï¼ˆä¼šè¯åˆå§‹åŒ–ï¼‰â”€â”€    â”‚
       â”‚                                    â”‚
       â”‚ â‘¢â”€â”€ å“åº”ï¼ˆæœåŠ¡å™¨èƒ½åŠ›ï¼‰â”€â”€â†’           â”‚
       â”‚                                    â”‚
       â”‚ â†â”€â”€ â‘£ tools/listï¼ˆå·¥å…·å‘ç°ï¼‰â”€â”€      â”‚
       â”‚                                    â”‚
       â”‚ â‘¤â”€â”€ å·¥å…·åˆ—è¡¨å“åº” â”€â”€â†’                â”‚
       â”‚                                    â”‚
       â”‚ â†â”€â”€ â‘¥ tools/callï¼ˆå·¥å…·è°ƒç”¨ï¼‰â”€â”€      â”‚
       â”‚                                    â”‚
       â”‚ â‘¦â”€â”€ æ‰§è¡Œç»“æœå“åº” â”€â”€â†’                â”‚
       â”‚                                    â”‚
```

**è¯¦ç»†æ­¥éª¤è¯´æ˜ï¼š**

1. **ğŸš€ è®¾å¤‡å¯åŠ¨**ï¼šè®¾å¤‡å¯åŠ¨åé€šè¿‡åŸºç¡€åè®®ï¼ˆå¦‚ WebSocket/MQTTï¼‰ä¸çµçŸ½AIå»ºç«‹è¿æ¥
2. **ğŸ¤ åˆå§‹åŒ–ä¼šè¯**ï¼šçµçŸ½AIé€šè¿‡ MCP åè®®çš„ `initialize` æ–¹æ³•åˆå§‹åŒ–ä¼šè¯
3. **ğŸ” å‘ç°å·¥å…·**ï¼šçµçŸ½AIé€šè¿‡ `tools/list` è·å–è®¾å¤‡æ”¯æŒçš„æ‰€æœ‰å·¥å…·åŠå‚æ•°è¯´æ˜
4. **âš¡ æ‰§è¡Œæ§åˆ¶**ï¼šçµçŸ½AIé€šè¿‡ `tools/call` è°ƒç”¨å…·ä½“å·¥å…·ï¼Œå®ç°å¯¹è®¾å¤‡çš„æ§åˆ¶

### æµç¨‹å›¾

![MCPäº¤äº’æµç¨‹å›¾](./imgs/hardware-mcp/liucheng.jpeg)

## åè®®æ ¼å¼è§„èŒƒ

æ ¹æ® MCP åè®®è§„èŒƒï¼ŒMCP æ¶ˆæ¯æ˜¯å°è£…åœ¨åŸºç¡€é€šä¿¡åè®®ï¼ˆå¦‚ WebSocket æˆ– MQTTï¼‰çš„æ¶ˆæ¯ä½“ä¸­çš„ã€‚å…¶å†…éƒ¨ç»“æ„éµå¾ª [JSON-RPC 2.0](https://www.jsonrpc.org/specification) è§„èŒƒã€‚

### æ•´ä½“æ¶ˆæ¯ç»“æ„

```json
{
  "session_id": "...",    // ä¼šè¯ID
  "type": "mcp",          // æ¶ˆæ¯ç±»å‹ï¼Œå›ºå®šä¸º"mcp"
  "payload": {             // JSON-RPC 2.0è´Ÿè½½
    "jsonrpc": "2.0",
    "method": "...",      // æ–¹æ³•å (å¦‚ "initialize", "tools/list", "tools/call")
    "params": { ... },     // æ–¹æ³•å‚æ•° (å¯¹äº request)
    "id": ...,            // è¯·æ±‚ID (å¯¹äº request å’Œ response)
    "result": { ... },     // æ–¹æ³•æ‰§è¡Œç»“æœ (å¯¹äº success response)
    "error": { ... }       // é”™è¯¯ä¿¡æ¯ (å¯¹äº error response)
  }
}
```

### JSON-RPC 2.0å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `jsonrpc` | string | å›ºå®šçš„å­—ç¬¦ä¸² "2.0" |
| `method` | string | è¦è°ƒç”¨çš„æ–¹æ³•åç§°ï¼ˆå¯¹äº Requestï¼‰ |
| `params` | object | æ–¹æ³•çš„å‚æ•°ï¼Œä¸€ä¸ªç»“æ„åŒ–å€¼ï¼Œé€šå¸¸ä¸ºå¯¹è±¡ï¼ˆå¯¹äº Requestï¼‰ |
| `id` | number/string | è¯·æ±‚çš„æ ‡è¯†ç¬¦ï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚æ—¶æä¾›ï¼ŒæœåŠ¡å™¨å“åº”æ—¶åŸæ ·è¿”å›ã€‚ç”¨äºåŒ¹é…è¯·æ±‚å’Œå“åº” |
| `result` | any | æ–¹æ³•æˆåŠŸæ‰§è¡Œæ—¶çš„ç»“æœï¼ˆå¯¹äº Success Responseï¼‰ |
| `error` | object | æ–¹æ³•æ‰§è¡Œå¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯ï¼ˆå¯¹äº Error Responseï¼‰ |

## è¯¦ç»†äº¤äº’æµç¨‹

### æ­¥éª¤1ï¼šè¿æ¥å»ºç«‹ä¸èƒ½åŠ›é€šå‘Š

> **â° æ—¶æœº**ï¼šè®¾å¤‡å¯åŠ¨å¹¶æˆåŠŸè¿æ¥åˆ°çµçŸ½AIå¹³å°å  
> **ğŸ“¤ å‘é€æ–¹**ï¼šè®¾å¤‡ç«¯  
> **ğŸ“‹ æ¶ˆæ¯ç±»å‹**ï¼šåŸºç¡€åè®®çš„ "hello" æ¶ˆæ¯  
> **ğŸ¯ ç›®çš„**ï¼šå£°æ˜è®¾å¤‡æ”¯æŒçš„èƒ½åŠ›åˆ—è¡¨ï¼ŒåŒ…æ‹¬ MCP åè®®æ”¯æŒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è®¾å¤‡ç«¯    â”‚ â”€â”€â”€â”€ hello æ¶ˆæ¯ â”€â”€â†’ â”‚   çµçŸ½AIå¹³å°    â”‚
â”‚ (MCPæœåŠ¡å™¨) â”‚                    â”‚  (MCPå®¢æˆ·ç«¯)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“¨ è®¾å¤‡ç«¯ â†’ çµçŸ½å¹³å°**

```json
{
  "type": "hello",
  "version": "1.0",
  "features": {
    "mcp": true
  },
  "transport": "websocket", // æˆ– "mqtt"
  "audio_params": { },
  "session_id": "device_session_123" // è®¾å¤‡æ”¶åˆ°æœåŠ¡å™¨helloåå¯èƒ½è®¾ç½®
}
```

### æ­¥éª¤2ï¼šåˆå§‹åŒ–MCPä¼šè¯

> **â° æ—¶æœº**ï¼šçµçŸ½AIå¹³å°æ”¶åˆ°è®¾å¤‡ "hello" æ¶ˆæ¯ï¼Œç¡®è®¤è®¾å¤‡æ”¯æŒ MCP å  
> **ğŸ“¤ å‘é€æ–¹**ï¼šçµçŸ½AIå¹³å°ï¼ˆå®¢æˆ·ç«¯ï¼‰  
> **ğŸ”§ æ–¹æ³•**ï¼š`initialize`  
> **ğŸ¯ ç›®çš„**ï¼šå»ºç«‹ MCP ä¼šè¯ï¼Œäº¤æ¢å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨èƒ½åŠ›ä¿¡æ¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è®¾å¤‡ç«¯    â”‚ â†â”€â”€ initialize â”€â”€â”€â”€ â”‚   çµçŸ½AIå¹³å°    â”‚
â”‚ (MCPæœåŠ¡å™¨) â”‚                    â”‚  (MCPå®¢æˆ·ç«¯)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“¨ çµçŸ½å¹³å° â†’ è®¾å¤‡ç«¯**

```json
{
  "jsonrpc": "2.0",
  "method": "initialize",
  "params": {
    "capabilities": {
      // å®¢æˆ·ç«¯èƒ½åŠ›ï¼Œå¯é€‰
      
      // æ‘„åƒå¤´è§†è§‰ç›¸å…³
      "vision": {
        "url": "http://example.com/vision", // æ‘„åƒå¤´: å›¾ç‰‡å¤„ç†åœ°å€(å¿…é¡»æ˜¯httpåœ°å€, ä¸æ˜¯websocketåœ°å€)
        "token": "vision_token_123" // url token
      }
      
      // ... å…¶ä»–å®¢æˆ·ç«¯èƒ½åŠ›
    }
  },
  "id": 1 // è¯·æ±‚ ID
}
```

**â±ï¸ è®¾å¤‡å“åº”æ—¶æœº**ï¼šè®¾å¤‡æ”¶åˆ° initialize è¯·æ±‚å¹¶å¤„ç†å

**ğŸ“¨ è®¾å¤‡ç«¯ â†’ çµçŸ½å¹³å°**

```json
{
  "jsonrpc": "2.0",
  "id": 1, // åŒ¹é…è¯·æ±‚ ID
  "result": {
    "protocolVersion": "2024-11-05",
    "capabilities": {
      "tools": {} // è¿™é‡Œçš„ tools ä¼¼ä¹ä¸åˆ—å‡ºè¯¦ç»†ä¿¡æ¯ï¼Œéœ€è¦ tools/list
    },
    "serverInfo": {
      "name": "æ™ºèƒ½éŸ³ç®±è®¾å¤‡", // è®¾å¤‡åç§° (BOARD_NAME)
      "version": "1.2.3" // è®¾å¤‡å›ºä»¶ç‰ˆæœ¬
    }
  }
}
```

### æ­¥éª¤3ï¼šå‘ç°è®¾å¤‡å·¥å…·åˆ—è¡¨

> **â° æ—¶æœº**ï¼šçµçŸ½AIå¹³å°éœ€è¦è·å–è®¾å¤‡å½“å‰æ”¯æŒçš„å…·ä½“åŠŸèƒ½ï¼ˆå·¥å…·ï¼‰åˆ—è¡¨æ—¶  
> **ğŸ“¤ å‘é€æ–¹**ï¼šçµçŸ½AIå¹³å°ï¼ˆå®¢æˆ·ç«¯ï¼‰  
> **ğŸ”§ æ–¹æ³•**ï¼š`tools/list`  
> **ğŸ¯ ç›®çš„**ï¼šè·å–è®¾å¤‡æ”¯æŒçš„æ‰€æœ‰å·¥å…·åŠå…¶å‚æ•°è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è®¾å¤‡ç«¯    â”‚ â†â”€â”€ tools/list â”€â”€â”€â”€ â”‚   çµçŸ½AIå¹³å°    â”‚
â”‚ (MCPæœåŠ¡å™¨) â”‚                    â”‚  (MCPå®¢æˆ·ç«¯)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“¨ çµçŸ½å¹³å° â†’ è®¾å¤‡ç«¯**

```json
{
  "jsonrpc": "2.0",
  "method": "tools/list",
  "params": {
    "cursor": "" // ç”¨äºåˆ†é¡µï¼Œé¦–æ¬¡è¯·æ±‚ä¸ºç©ºå­—ç¬¦ä¸²
  },
  "id": 2 // è¯·æ±‚ ID
}
```

**â±ï¸ è®¾å¤‡å“åº”æ—¶æœº**ï¼šè®¾å¤‡æ”¶åˆ° tools/list è¯·æ±‚å¹¶ç”Ÿæˆå·¥å…·åˆ—è¡¨å

**ğŸ“¨ è®¾å¤‡ç«¯ â†’ çµçŸ½å¹³å°**

#### å“åº”æ ¼å¼ä¸€ï¼šæ ‡å‡†å·¥å…·åˆ—è¡¨ï¼ˆå‘åå…¼å®¹ï¼‰

```json
{
  "jsonrpc": "2.0",
  "id": 2, // åŒ¹é…è¯·æ±‚ ID
  "result": {
    "tools": [ // å·¥å…·å¯¹è±¡åˆ—è¡¨
      {
        "name": "self.get_device_status",
        "description": "è·å–è®¾å¤‡å½“å‰çŠ¶æ€ä¿¡æ¯",
        "inputSchema": {
          "type": "object",
          "properties": {},
          "required": []
        }
      },
      {
        "name": "self.audio_speaker.set_volume",
        "description": "è®¾ç½®éŸ³ç®±éŸ³é‡",
        "inputSchema": {
          "type": "object",
          "properties": {
            "volume": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100,
              "description": "éŸ³é‡å¤§å°ï¼ŒèŒƒå›´0-100"
            }
          },
          "required": ["volume"]
        }
      }
      // ... æ›´å¤šå·¥å…·
    ],
    "nextCursor": null // å¦‚æœåˆ—è¡¨å¾ˆå¤§éœ€è¦åˆ†é¡µï¼Œè¿™é‡Œä¼šåŒ…å«ä¸‹ä¸€ä¸ªè¯·æ±‚çš„ cursor å€¼
  }
}
```

#### å“åº”æ ¼å¼äºŒï¼šå¸¦ç±»å‹æ ‡è¯†çš„å·¥å…·åˆ—è¡¨ï¼ˆæ¨èï¼‰

ä¸ºäº†åŒæ—¶æ”¯æŒæ ‡å‡†å·¥å…·ï¼ˆtoolï¼‰å’Œ RPC å‡½æ•°è°ƒç”¨ï¼ˆrpcï¼‰ï¼Œæ–°å¢ `type` å­—æ®µç”¨äºåŒºåˆ†å·¥å…·ç±»å‹ï¼š

```json
{
  "jsonrpc": "2.0",
  "id": 2, // åŒ¹é…è¯·æ±‚ ID
  "result": {
    "tools": [ // å·¥å…·å¯¹è±¡åˆ—è¡¨
      {
        "name": "self.get_device_status",
        "description": "è·å–è®¾å¤‡å½“å‰çŠ¶æ€ä¿¡æ¯",
        "type": <int>, // å‡½æ•°ç±»å‹ï¼Œ0 è¡¨ç¤º tool å‡½æ•°ï¼Œ1 è¡¨ç¤º rpc å‡½æ•°
        "inputSchema": {
          "type": "object",
          "properties": {},
          "required": []
        }
      },
      {
        "name": "self.audio_speaker.set_volume",
        "description": "è®¾ç½®éŸ³ç®±éŸ³é‡",
        "type": 0, // å‡½æ•°ç±»å‹ï¼Œ0 è¡¨ç¤º tool å‡½æ•°
        "inputSchema": {
          "type": "object",
          "properties": {
            "volume": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100,
              "description": "éŸ³é‡å¤§å°ï¼ŒèŒƒå›´0-100"
            }
          },
          "required": ["volume"]
        }
      }
      // ... æ›´å¤šå·¥å…·
    ],
    "nextCursor": null // å¦‚æœåˆ—è¡¨å¾ˆå¤§éœ€è¦åˆ†é¡µï¼Œè¿™é‡Œä¼šåŒ…å«ä¸‹ä¸€ä¸ªè¯·æ±‚çš„ cursor å€¼
  }
}
```

**å­—æ®µè¯´æ˜**ï¼š

- `type`ï¼šå‡½æ•°ç±»å‹æ ‡è¯†ï¼Œ0 è¡¨ç¤º tool å‡½æ•°ï¼Œ1 è¡¨ç¤º rpc å‡½æ•°
- å…¶ä»–å­—æ®µä¸æ ‡å‡† MCP å·¥å…·å®šä¹‰ä¿æŒä¸€è‡´

**åˆ†é¡µå¤„ç†**ï¼šå¦‚æœ `nextCursor` å­—æ®µéç©ºï¼Œå®¢æˆ·ç«¯éœ€è¦å†æ¬¡å‘é€ `tools/list` è¯·æ±‚ï¼Œå¹¶åœ¨ `params` ä¸­å¸¦ä¸Šè¿™ä¸ª cursor å€¼ä»¥è·å–ä¸‹ä¸€é¡µå·¥å…·ã€‚

### æ­¥éª¤4ï¼šè°ƒç”¨è®¾å¤‡å·¥å…·

> **â° æ—¶æœº**ï¼šçµçŸ½AIå¹³å°éœ€è¦æ‰§è¡Œè®¾å¤‡ä¸Šçš„æŸä¸ªå…·ä½“åŠŸèƒ½æ—¶  
> **ğŸ“¤ å‘é€æ–¹**ï¼šçµçŸ½AIå¹³å°ï¼ˆå®¢æˆ·ç«¯ï¼‰  
> **ğŸ”§ æ–¹æ³•**ï¼š`tools/call`  
> **ğŸ¯ ç›®çš„**ï¼šè°ƒç”¨è®¾å¤‡ä¸Šçš„å…·ä½“å·¥å…·ï¼Œæ‰§è¡Œå®é™…çš„æ§åˆ¶æ“ä½œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è®¾å¤‡ç«¯    â”‚ â†â”€â”€ tools/call â”€â”€â”€â”€ â”‚   çµçŸ½AIå¹³å°    â”‚
â”‚ (MCPæœåŠ¡å™¨) â”‚                    â”‚  (MCPå®¢æˆ·ç«¯)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“¨ çµçŸ½å¹³å° â†’ è®¾å¤‡ç«¯**

```json
{
  "jsonrpc": "2.0",
  "method": "tools/call",
  "params": {
    "name": "self.audio_speaker.set_volume", // è¦è°ƒç”¨çš„å·¥å…·åç§°
    "arguments": {
      // å·¥å…·å‚æ•°ï¼Œå¯¹è±¡æ ¼å¼
      "volume": 50 // å‚æ•°ååŠå…¶å€¼
    }
  },
  "id": 3 // è¯·æ±‚ ID
}
```

**â±ï¸ è®¾å¤‡å“åº”æ—¶æœº**ï¼šè®¾å¤‡æ”¶åˆ° tools/call è¯·æ±‚ï¼Œæ‰§è¡Œç›¸åº”çš„å·¥å…·å‡½æ•°å

**ğŸ“¨ è®¾å¤‡ç«¯ â†’ çµçŸ½å¹³å°ï¼ˆæˆåŠŸå“åº”ï¼‰**

```json
{
  "jsonrpc": "2.0",
  "id": 3, // åŒ¹é…è¯·æ±‚ ID
  "result": {
    "content": [
      {
        "type": "text",
        "text": "éŸ³é‡å·²è®¾ç½®ä¸º50%"
      }
    ],
    "isError": false
  }
}
```

**ğŸ“¨ è®¾å¤‡ç«¯ â†’ çµçŸ½å¹³å°ï¼ˆé”™è¯¯å“åº”ï¼‰**

```json
{
  "jsonrpc": "2.0",
  "id": 3,
  "error": {
    "code": -32601,
    "message": "æœªçŸ¥å·¥å…·: self.non_existent_tool"
  }
}
```

## è®¾å¤‡ç«¯å·¥å…·æ³¨å†Œæ–¹æ³•

### AddToolæ–¹æ³•è¯´æ˜

è®¾å¤‡é€šè¿‡ `McpServer::AddTool` æ–¹æ³•æ³¨å†Œå¯è¢«çµçŸ½AIå¹³å°è°ƒç”¨çš„"å·¥å…·"ã€‚å…¶å¸¸ç”¨å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š

```cpp
void AddTool(
    const std::string& name,           // å·¥å…·åç§°ï¼Œå»ºè®®å”¯ä¸€ä¸”æœ‰å±‚æ¬¡æ„Ÿï¼Œå¦‚ self.dog.forward
    const std::string& description,    // å·¥å…·æè¿°ï¼Œç®€æ˜è¯´æ˜åŠŸèƒ½ï¼Œä¾¿äºå¤§æ¨¡å‹ç†è§£
    const PropertyList& properties,    // è¾“å…¥å‚æ•°åˆ—è¡¨ï¼ˆå¯ä¸ºç©ºï¼‰ï¼Œæ”¯æŒç±»å‹ï¼šå¸ƒå°”ã€æ•´æ•°ã€å­—ç¬¦ä¸²
    std::function<ReturnValue(const PropertyList&)> callback // å·¥å…·è¢«è°ƒç”¨æ—¶çš„å›è°ƒå®ç°
);
```

**å‚æ•°è¯´æ˜**ï¼š

- `name`ï¼šå·¥å…·å”¯ä¸€æ ‡è¯†ï¼Œå»ºè®®ç”¨"æ¨¡å—.åŠŸèƒ½"å‘½åé£æ ¼
- `description`ï¼šè‡ªç„¶è¯­è¨€æè¿°ï¼Œä¾¿äº AI/ç”¨æˆ·ç†è§£
- `properties`ï¼šå‚æ•°åˆ—è¡¨ï¼Œæ”¯æŒç±»å‹æœ‰å¸ƒå°”ã€æ•´æ•°ã€å­—ç¬¦ä¸²ï¼Œå¯æŒ‡å®šèŒƒå›´å’Œé»˜è®¤å€¼
- `callback`ï¼šæ”¶åˆ°è°ƒç”¨è¯·æ±‚æ—¶çš„å®é™…æ‰§è¡Œé€»è¾‘ï¼Œè¿”å›å€¼å¯ä¸º bool/int/string

### å…¸å‹æ³¨å†Œç¤ºä¾‹

ä»¥ä¸‹æ˜¯å…¸å‹çš„å·¥å…·æ³¨å†Œç¤ºä¾‹ï¼ˆä»¥ ESP-Hi ä¸ºä¾‹ï¼‰ï¼š

```cpp
void InitializeTools() {
    auto& mcp_server = McpServer::GetInstance();
    
    // ä¾‹1ï¼šæ— å‚æ•°ï¼Œæ§åˆ¶æœºå™¨äººå‰è¿›
    mcp_server.AddTool("self.dog.forward", "æœºå™¨äººå‘å‰ç§»åŠ¨", PropertyList(), 
        [this](const PropertyList&) -> ReturnValue {
            servo_dog_ctrl_send(DOG_STATE_FORWARD, NULL);
            return true;
        });
    
    // ä¾‹2ï¼šå¸¦å‚æ•°ï¼Œè®¾ç½®ç¯å…‰ RGB é¢œè‰²
    mcp_server.AddTool("self.light.set_rgb", "è®¾ç½®RGBé¢œè‰²", PropertyList({
        Property("r", kPropertyTypeInteger, 0, 255),
        Property("g", kPropertyTypeInteger, 0, 255),
        Property("b", kPropertyTypeInteger, 0, 255)
    }), [this](const PropertyList& properties) -> ReturnValue {
        int r = properties["r"].value<int>();
        int g = properties["g"].value<int>();
        int b = properties["b"].value<int>();
        led_on_ = true;
        SetLedColor(r, g, b);
        return true;
    });
}
```
